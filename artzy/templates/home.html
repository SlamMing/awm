{% extends 'base.html' %}
{% block content %}
<div class='row'>
    <div class='col-md-4 mx-auto col-10'>
        <form class='form' id='post-create-form' method='POST' action='/create-post'>
            {% csrf_token %}
        <input type='hidden' value='/' name='next' />
        <textarea class='form-control' name='description' placeholder='Painting description'></textarea>
        <button type ='submit' class='btn btn-primary'>Post</button>
        </form>
    </div>
</div>
<div class='row text-center' id='posts'>
<script>
    function handleLike(post_id, cCount){
        cCount++
        return
    }

    function likeButt(post) {
        return "<button class='btn btn-primary btn-sm' onclick=handleLike("
         + post.id +"," + post.like_count +")>" + post.like_count + "Likes</button>"
    }
</script>
<script>
    function handlePostCreateSubmit(event){
        event.preventDefault()
        //retrieve form
        const form = event.target
        const fd = new FormData(form)
        for(var item of fd.entries()){
            console.log(item)
        }
        console.log(event)
    }
    const postCreateElem = document.getElementById("post-create-form")
    postCreateElem.addEventListener("submit", handlePostCreateSubmit)
    const postsElem = document.getElementById("posts")

    //function to display posts, updates on load
    function loadPosts() {
        const xhr = new XMLHttpRequest()
        const method = 'GET'
        const url = "/posts"
        const responseType = "json"
        xhr.responseType = responseType
        xhr.open(method, url)
        xhr.onload = function(){
            //get list from response
            const serverResponse = xhr.response
            const listedItems = serverResponse.response
            var header = "<div class='mb-4 col-12 col-md-10 mx-auto border rounded py-3'>"
            var finalPostStr = ""
            var i;
            for (i = 0; i < listedItems.length; i++){
                post = listedItems[i]
                finalPostStr += header
                var cur = "<h3>" + //+ post.id + " " +
                    post.description +  " " +
                    //post.like_count +  " " +
                    //post.author_id +  " " +
                    "</h3>"
                
                finalPostStr += cur
                finalPostStr += likeButt(post)
                finalPostStr += "</div>"     
            }
            
            postsElem.innerHTML = finalPostStr
            }
        xhr.send()
        }
    loadPosts(postsElem)

    
</script>
</div>
{% endblock content %}